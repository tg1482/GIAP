---
output:
  html_document:
    theme: cosmo
always_allow_html: yes
bibliography: bibliography.bib
nocite: | 
  @author1, @author2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, comment=NA, fig.width = 6, fig.asp = 0.618, out.width = "80%", fig.align = "center", fig.show='hold')
```

```{r initialize}
hospital_names <- unique(giap$`Hospital.Name`)[!is.na(unique(giap$`Hospital.Name`))]

id <- unique(giap$Hospital.ID[giap$Hospital.Name==name] %>% na.omit())
```

```{r, fig.align = "left", out.width='15%'}
#knitr::include_graphics("NICHE_logo.jpg")
```


<center>
# **Nurses Improving Care for Healthsystem Elders**
## **Geriatric Institutional Assessment Profile Report**
### **February 2019 Cohort**
</center>

#### **`r name`**
**GIAP Overview**

The Geriatric Institutional Assessment Profile (GIAP) is a baseline assessment of nurses' knowledge, skills, attitudes and perceptions regarding care for older adults. The information generated from the GIAP is used to identify strengths and prioritize opportunities to improve nursing practice to support clinical excellence in the care of older adults.     

The GIAP (v.8) provides clinical leaders with information about nurses' perceptions regarding:     

* Knowledge to identify and manage the geriatric syndromes 
* Availability of specialized resource to care for older adults
* Age-friendly care planning and delivery 
* Organizational values regarding care of older adults 
* Unit environment to support NICHE program implementation
  
**How to Use the GIAP Results to Improve Nursing Care for Older Adults**

The results are reported in two sections. The first section summarizes nurses' knowledge about the geriatric syndromes of delirium, falls, pressure injuries, and incontinence and the nursing problems of pain, nutrition and hydration, restraint use, and managing behaviors associated with dementia and cognitive decline. The second section summarizes nurses' views about the unit environment to support age-friendly care.

We use the quality improvement convention of the red, yellow and green stop light colors to present the GIAP results. Where applicable, the mean score for the cohort and your hospital are marked with an asterisks (*). As you review the diagrams, yellow and green denote higher performance on each measure.   

Following the generally accepted nursing education standards, a mean score of 80% demonstrates mastery of clinical knowledge required to identify and manage the common clinical conditions experienced by older adults. Drawing on insights from organizational change, we recommend that approximately 75% of nurses on the units involved in the NICHE initiative at your hospital will agree or strongly agree that they have access to the necessary clinical and organizational resources to support the delivery of age-friendly care on their units. 

In the final section of this report, we offer recommendations for how to use the GIAP results to guide NICHE implementation efforts at your hospital.

<center>
#### **Nurse Characteristics**
</center>

**Participants:** The data included in this report were collected between `r min(lubridate::month(giap$startDate,label = TRUE))`-`r min(lubridate::year(giap$startDate))` and `r max(lubridate::month(giap$startDate,label = TRUE))`-`r max(lubridate::year(giap$startDate))`.  A total of `r nrow(giap %>% filter(Hospital.Name==name))` nurses at `r name` provided compete data for the questions included in this report. The demographic characteristics for the participating nursing staff from `r name` are summarized in the following tables.

**Gender**

```{r}
giap %>%
  filter(!is.na(Q21))%>%
  rename(Gender = Q21) %>%
  count(Gender) %>%
  mutate(Percent = round(n / sum(n) * 100, 1),
         Gender = case_when(Gender == 1 ~ "Male",
                            Gender == 2 ~ "Female",
                            Gender == 3 ~ "Prefer not to Report",
                            Gender == 9 ~ "Prefer not to Report"),
         Gender = factor(Gender, levels = c("Prefer not to Report", "Male", "Female"))) %>%
  arrange(desc(n)) %>% rename(Count = n) %>% 
  full_join(giap %>%
              filter(Hospital.Name ==name, !is.na(Q21)) %>%
              rename(Gender = Q21) %>%
              count(Gender) %>%
              mutate(Percent = round(n / sum(n) * 100, 1),
                     Gender = case_when(Gender == 1 ~ "Male",
                                        Gender == 2 ~ "Female",
                                        Gender == 3 ~ "Prefer not to Report",
                                        Gender == 9 ~ "Prefer not to Report"),
                     Gender = factor(Gender, levels = c("Prefer not to Report", "Male", "Female"))) %>%
              #arrange(desc(n)) %>% 
              rename(Count = n), by = "Gender") %>%
  setNames(c("Gender", "Numbers", "Percentage", "Numbers", "Percentage")) %>%     
  apply(MARGIN = 2, function (x) ifelse(is.na(x), 0, x)) %>% as.data.frame() %>% 
  kable(format = "html") %>% 
  kable_styling() %>% 
  add_header_above(c(" " = 1, "Cohort" = 2, "Hospital" = 2)) %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em") %>% 
  column_spec(4, width = "10em") %>% 
  column_spec(5, width = "10em")
```


**Ethnicity**

```{r}
giap %>%
  filter(!is.na(Q22), Q22 ==1) %>%
  mutate(Q22 = case_when(Q22 == 1 ~ "Hispanic or Latino/Latina")) %>% 
  rename(Ethnicity = Q22) %>% 
  count(Ethnicity)%>% 
  rbind({giap %>%
      filter(!is.na(Q23_1), Q23_1 ==1) %>%
      mutate(Q23_1 = case_when(Q23_1 == 1 ~ "American Indian or Alaskan Native")) %>% 
      rename(`Ethnicity` = Q23_1) %>% 
      count(Ethnicity)}) %>% 
  rbind({giap %>%
      filter(!is.na(Q23_2), Q23_2 ==1) %>%
      mutate(Q23_2 = case_when(Q23_2 == 1 ~ "Asian")) %>% 
      rename(`Ethnicity` = Q23_2) %>%
      count(`Ethnicity`)}) %>% 
  rbind({giap %>%
      filter(!is.na(Q23_3), Q23_3 ==1) %>%
      mutate(Q23_3 = case_when(Q23_3 == 1 ~ "Black or African American")) %>% 
      rename(`Ethnicity` = Q23_3) %>%
      count(`Ethnicity`)}) %>% 
  rbind({giap %>%
      filter(!is.na(Q23_4), Q23_4==1) %>%
      mutate(Q23_4 = case_when(Q23_4 == 1 ~ "Native Hawaiian or Pacific Islander")) %>% 
      rename(`Ethnicity` = Q23_4) %>%
      count(`Ethnicity`)}) %>% 
  rbind({giap %>%
      filter(!is.na(Q23_5), Q23_5==1) %>%
      mutate(Q23_5 = case_when(Q23_5 == 1 ~ "White")) %>% 
      rename(`Ethnicity` = Q23_5) %>%
      count(`Ethnicity`)}) %>% 
  rbind({giap %>%
      filter(!is.na(Q23_6), Q23_6==1) %>%
      mutate(Q23_6 = case_when(Q23_6 == 1 ~ "Other")) %>% 
      rename(`Ethnicity` = Q23_6) %>%
      count(`Ethnicity`)}) %>% 
  {.[order(.$n, decreasing = T),]} %>% 
  rbind(c("Ethnicity" = "Refused to Answer", 
          "n" = nrow(giap %>% 
                       filter((Q23_1==9&Q23_2==9&Q23_3==9&Q23_4==9&Q23_5==9&Q23_6==9) |
                                (Q23_1==0&Q23_2==0&Q23_3==0&Q23_4==0&Q23_5==0&Q23_6==0))))) %>% 
  mutate(n = as.numeric(n),
         n = round(n / sum(n) * 100, 1)) %>% 
  rename(Count = n) %>% 
  full_join(giap %>%
  filter(Hospital.Name ==name,!is.na(Q22), Q22 ==1) %>%
  mutate(Q22 = case_when(Q22 == 1 ~ "Hispanic or Latino/Latina")) %>% 
  rename(Ethnicity = Q22) %>% 
  count(Ethnicity)%>% 
  rbind({giap %>%
      filter(Hospital.Name ==name,!is.na(Q23_1), Q23_1 ==1) %>%
      mutate(Q23_1 = case_when(Q23_1 == 1 ~ "American Indian or Alaskan Native")) %>% 
      rename(`Ethnicity` = Q23_1) %>% 
      count(Ethnicity)}) %>% 
  rbind({giap %>%
      filter(Hospital.Name ==name,!is.na(Q23_2), Q23_2 ==1) %>%
      mutate(Q23_2 = case_when(Q23_2 == 1 ~ "Asian")) %>% 
      rename(`Ethnicity` = Q23_2) %>%
      count(`Ethnicity`)}) %>% 
  rbind({giap %>%
      filter(Hospital.Name ==name,!is.na(Q23_3), Q23_3 ==1) %>%
      mutate(Q23_3 = case_when(Q23_3 == 1 ~ "Black or African American")) %>% 
      rename(`Ethnicity` = Q23_3) %>%
      count(`Ethnicity`)}) %>% 
  rbind({giap %>%
      filter(Hospital.Name ==name,!is.na(Q23_4), Q23_4==1) %>%
      mutate(Q23_4 = case_when(Q23_4 == 1 ~ "Native Hawaiian or Pacific Islander")) %>% 
      rename(`Ethnicity` = Q23_4) %>%
      count(`Ethnicity`)}) %>% 
  rbind({giap %>%
      filter(Hospital.Name ==name,!is.na(Q23_5), Q23_5==1) %>%
      mutate(Q23_5 = case_when(Q23_5 == 1 ~ "White")) %>% 
      rename(`Ethnicity` = Q23_5) %>%
      count(`Ethnicity`)}) %>% 
  rbind({giap %>%
      filter(Hospital.Name ==name,!is.na(Q23_6), Q23_6==1) %>%
      mutate(Q23_6 = case_when(Q23_6 == 1 ~ "Other")) %>% 
      rename(`Ethnicity` = Q23_6) %>%
      count(`Ethnicity`)}) %>% 
  {.[order(.$n, decreasing = T),]} %>% 
  rbind(c("Ethnicity" = "Refused to Answer", 
          "n" = nrow(giap %>% filter(Hospital.Name==name & 
                   ((Q23_1==9 & Q23_2==9& Q23_3==9& Q23_4==9& Q23_5==9 & Q23_6==9) | 
                      (Q23_1==0 & Q23_2==0& Q23_3==0& Q23_4==0& Q23_5==0 & Q23_6==0)))))) %>% 
  mutate(n = as.numeric(n),
         n = round(n / sum(n) * 100, 1)) %>% 
  rename(Count = n), by = "Ethnicity") %>% 
  mutate_if(is.numeric, na_to_zero) %>% 
  setNames(c("Ethnicity", "Cohort (%)", "Hospital (%)")) %>% 
  kable(format = "html", table.attr = "style='width:90%;'") %>% 
  kable_styling() %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em")
```


**Years of Practice Experience**

```{r}
giap %>% 
  select(Q2) %>% 
  mutate(Cat = case_when(Q2 <= 1 ~ 1,
                         Q2 > 1 & Q2 <= 5 ~ 2,
                         Q2 > 5 & Q2 <= 10 ~ 3,
                         Q2 > 10 & Q2 <= 15 ~ 4,
                         Q2 > 15 & Q2 <= 20 ~ 5,
                         Q2 > 20 & Q2 < 40 ~ 6,
                         Q2 >= 40 & Q2 < 80 ~ 7,
                         is.na(Q2) ~ 8,
                         Q2 == 99 ~ 8),
         Term = case_when(Cat == 1 ~ "Less than 1 year",
                          Cat == 2 ~ "Between 1 and 5 years",
                          Cat == 3 ~ "Between 5 and 10 years",
                          Cat == 4 ~ "Between 10 and 15 years",
                          Cat == 5 ~ "Between 15 and 20 years",
                          Cat == 6 ~ "Between 20 and 40 years",
                          Cat == 7 ~ "40 and above",
                          Cat == 8 ~ "Prefer Not to Report")) %>% 
  group_by(Term, Cat) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  arrange(Cat) %>% 
  rename(Experience = Term) %>% 
  select(-Cat) %>%
  full_join(giap %>% 
  filter(Hospital.Name == name) %>% 
  select(Q2) %>% 
  mutate(Cat = case_when(Q2 <= 1 ~ 1,
                         Q2 > 1 & Q2 <= 5 ~ 2,
                         Q2 > 5 & Q2 <= 10 ~ 3,
                         Q2 > 10 & Q2 <= 15 ~ 4,
                         Q2 > 15 & Q2 <= 20 ~ 5,
                         Q2 > 20 & Q2 < 40 ~ 6,
                         Q2 >= 40 & Q2 < 80 ~ 7,
                         is.na(Q2) ~ 8,
                         Q2 == 99 ~ 8),
         Term = case_when(Cat == 1 ~ "Less than 1 year",
                          Cat == 2 ~ "Between 1 and 5 years",
                          Cat == 3 ~ "Between 5 and 10 years",
                          Cat == 4 ~ "Between 10 and 15 years",
                          Cat == 5 ~ "Between 15 and 20 years",
                          Cat == 6 ~ "Between 20 and 40 years",
                          Cat == 7 ~ "40 and above",
                          Cat == 8 ~ "Prefer Not to Report")) %>% 
  group_by(Term, Cat) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  arrange(Cat) %>% 
  rename(Experience = Term) %>% 
  select(-Cat), by = "Experience") %>%
  mutate_if(is.numeric, na_to_zero) %>%
  setNames(c("Experience", "Cohort (%)", "Hospital (%)")) %>%    
  as.data.frame() %>% 
  kable(format = "html", table.attr = "style='width:90%;'") %>% 
  kable_styling() %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em")
```

**Years working for Employer**

```{r}
giap %>% 
  select(Q3) %>% 
  mutate(Cat = case_when(Q3 <= 1 ~ 1,
                         Q3 > 1 & Q3 <= 5 ~ 2,
                         Q3 > 5 & Q3 <= 10 ~ 3,
                         Q3 > 10 & Q3 <= 15 ~ 4,
                         Q3 > 15 & Q3 <= 20 ~ 5,
                         Q3 > 20 & Q3 < 40 ~ 6,
                         Q3 >= 40 & Q3 < 80 ~ 7,
                         is.na(Q3) ~ 8,
                         Q3 == 99 ~ 8),
         Term = case_when(Cat == 1 ~ "Less than 1 year",
                          Cat == 2 ~ "Between 1 and 5 years",
                          Cat == 3 ~ "Between 5 and 10 years",
                          Cat == 4 ~ "Between 10 and 15 years",
                          Cat == 5 ~ "Between 15 and 20 years",
                          Cat == 6 ~ "Between 20 and 40 years",
                          Cat == 7 ~ "40 and above",
                          Cat == 8 ~ "Prefer Not to Report")) %>% 
  group_by(Term, Cat) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  arrange(Cat) %>% 
  rename(Experience = Term) %>% 
  select(-Cat) %>%
  full_join(giap %>% 
  filter(Hospital.Name == name) %>% 
  select(Q3) %>% 
  mutate(Cat = case_when(Q3 <= 1 ~ 1,
                         Q3 > 1 & Q3 <= 5 ~ 2,
                         Q3 > 5 & Q3 <= 10 ~ 3,
                         Q3 > 10 & Q3 <= 15 ~ 4,
                         Q3 > 15 & Q3 <= 20 ~ 5,
                         Q3 > 20 & Q3 < 40 ~ 6,
                         Q3 >= 40 & Q3 < 80 ~ 7,
                         is.na(Q3) ~ 8,
                         Q3 == 99 ~ 8),
         Term = case_when(Cat == 1 ~ "Less than 1 year",
                          Cat == 2 ~ "Between 1 and 5 years",
                          Cat == 3 ~ "Between 5 and 10 years",
                          Cat == 4 ~ "Between 10 and 15 years",
                          Cat == 5 ~ "Between 15 and 20 years",
                          Cat == 6 ~ "Between 20 and 40 years",
                          Cat == 7 ~ "40 and above",
                          Cat == 8 ~ "Prefer Not to Report")) %>% 
  group_by(Term, Cat) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  arrange(Cat) %>% 
  rename(Experience = Term) %>% 
  select(-Cat), by = "Experience") %>%
  mutate_if(is.numeric, na_to_zero) %>%
  setNames(c("Years Worked", "Cohort (%)", "Hospital (%)")) %>%    
  as.data.frame() %>% 
  kable(format = "html", table.attr = "style='width:90%;'") %>% 
  kable_styling() %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em")
```

**Completed NICHE GRN Program**

```{r}
giap %>%
  rename(GRN = Q40) %>%
  count(GRN) %>%
  mutate(Percent = round(n / sum(n) * 100, 1),
         GRN = case_when(GRN == 1 ~ "Yes",
                         GRN == 2 ~ "No",
                         GRN == 9 ~ "Prefer not to Report",
                         is.na(GRN) ~ "Prefer not to Report"),
         GRN = factor(GRN, levels = c("Prefer not to Report", "No", "Yes"))) %>%
  rename(Count = n) %>% 
  full_join(giap %>%
              filter(Hospital.Name ==name) %>%
              rename(GRN = Q40) %>%
              count(GRN) %>%
              mutate(Percent = round(n / sum(n) * 100, 1),
                     GRN = case_when(GRN == 1 ~ "Yes",
                                     GRN == 2 ~ "No",
                                     GRN == 9 ~ "Prefer not to Report",
                                     is.na(GRN) ~ "Prefer not to Report"),
                     GRN = factor(GRN, levels = c("Prefer not to Report", "No", "Yes"))) %>%
              #arrange(desc(n)) %>% 
              rename(Count = n), by = "GRN") %>%
  setNames(c("Completed GRN", "Numbers", "Percentage", "Numbers", "Percentage")) %>%     
  apply(MARGIN = 2, function (x) ifelse(is.na(x), 0, x)) %>% as.data.frame() %>% 
  kable(format = "html") %>% 
  kable_styling() %>% 
  add_header_above(c(" " = 1, "Cohort" = 2, "Hospital" = 2)) %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em") %>% 
  column_spec(4, width = "10em") %>% 
  column_spec(5, width = "10em")
```

**Currently enrolled in a full-time or part-time formal nursing education program**

```{r}
giap %>%
  rename(Enroll = Q25) %>%
  count(Enroll) %>%
  mutate(Percent = round(n / sum(n) * 100, 1),
         Enroll = case_when(Enroll == 1 ~ "Yes, full-time",
                         Enroll == 2 ~ "Yes, part-time",
                         Enroll == 3 ~ "No",
                         Enroll == -1 ~ "Prefer not to Report",
                         Enroll == 9 ~ "Prefer not to Report",
                         is.na(Enroll) ~ "Prefer not to Report"),
         Enroll = factor(Enroll, levels = c("Prefer not to Report", "No", "Yes, part-time", "Yes, full-time"))) %>%
  rename(Count = n) %>% 
  full_join(giap %>%
              filter(Hospital.Name ==name) %>%
              rename(Enroll = Q25) %>%
              count(Enroll) %>%
              mutate(Percent = round(n / sum(n) * 100, 1),
                     Enroll = case_when(Enroll == 1 ~ "Yes, full-time",
                         Enroll == 2 ~ "Yes, part-time",
                         Enroll == 3 ~ "No",
                         Enroll == -1 ~ "Prefer not to Report",
                         Enroll == 9 ~ "Prefer not to Report",
                         is.na(Enroll) ~ "Prefer not to Report"),
                     Enroll = factor(Enroll, levels = c("Prefer not to Report", "No", "Yes, part-time", "Yes, full-time")))%>%
              #arrange(desc(n)) %>% 
              rename(Count = n), by = "Enroll") %>%
  setNames(c("Currently Enrolled", "Numbers", "Percentage", "Numbers", "Percentage")) %>%     
  apply(MARGIN = 2, function (x) ifelse(is.na(x), 0, x)) %>% as.data.frame() %>% 
  kable(format = "html") %>% 
  kable_styling() %>% 
  add_header_above(c(" " = 1, "Cohort" = 2, "Hospital" = 2)) %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em") %>% 
  column_spec(4, width = "10em") %>% 
  column_spec(5, width = "10em")
```

**Completed National Specialty Certification and/or Nurse Practitioner Certification**

```{r}
giap %>%
  rename(NATLCERT = Q26) %>%
  count(NATLCERT) %>%
  mutate(Percent = round(n / sum(n) * 100, 1),
         NATLCERT = case_when(NATLCERT == 1 ~ "Yes",
                         NATLCERT == 2 ~ "No",
                         NATLCERT == 9 ~ "Prefer not to Report",
                         is.na(NATLCERT) ~ "Prefer not to Report"),
         NATLCERT = factor(NATLCERT, levels = c("Prefer not to Report", "No", "Yes"))) %>%
  rename(Count = n) %>% 
  full_join(giap %>%
              filter(Hospital.Name ==name) %>%
              rename(NATLCERT = Q26) %>%
              count(NATLCERT) %>%
              mutate(Percent = round(n / sum(n) * 100, 1),
                     NATLCERT = case_when(NATLCERT == 1 ~ "Yes",
                                     NATLCERT == 2 ~ "No",
                                     NATLCERT == 9 ~ "Prefer not to Report",
                                     is.na(NATLCERT) ~ "Prefer not to Report"),
                     NATLCERT = factor(NATLCERT, levels = c("Prefer not to Report", "No", "Yes"))) %>%
              #arrange(desc(n)) %>% 
              rename(Count = n), by = "NATLCERT") %>%
  setNames(c("Completed Certification", "Numbers", "Percentage", "Numbers", "Percentage")) %>%     
  apply(MARGIN = 2, function (x) ifelse(is.na(x), 0, x)) %>% as.data.frame() %>% 
  kable(format = "html") %>% 
  kable_styling() %>% 
  add_header_above(c(" " = 1, "Cohort" = 2, "Hospital" = 2)) %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em") %>% 
  column_spec(4, width = "10em") %>% 
  column_spec(5, width = "10em")
```

**Completed National Specialty Certification in Gerontological Nursing**

```{r}
giap %>%
  rename(NATLCERT = Q27) %>%
  count(NATLCERT) %>%
  mutate(Percent = round(n / sum(n) * 100, 1),
         NATLCERT = case_when(NATLCERT == 1 ~ "Yes",
                         NATLCERT == 2 ~ "No",
                         NATLCERT == 9 ~ "Prefer not to Report",
                         is.na(NATLCERT) ~ "Prefer not to Report"),
         NATLCERT = factor(NATLCERT, levels = c("Prefer not to Report", "No", "Yes"))) %>%
  rename(Count = n) %>% 
  full_join(giap %>%
              filter(Hospital.Name ==name) %>%
              rename(NATLCERT = Q27) %>%
              count(NATLCERT) %>%
              mutate(Percent = round(n / sum(n) * 100, 1),
                     NATLCERT = case_when(NATLCERT == 1 ~ "Yes",
                                     NATLCERT == 2 ~ "No",
                                     NATLCERT == 9 ~ "Prefer not to Report",
                                     is.na(NATLCERT) ~ "Prefer not to Report"),
                     NATLCERT = factor(NATLCERT, levels = c("Prefer not to Report", "No", "Yes"))) %>%
              #arrange(desc(n)) %>% 
              rename(Count = n), by = "NATLCERT") %>%
  setNames(c("Completed Certification", "Numbers", "Percentage", "Numbers", "Percentage")) %>%     
  apply(MARGIN = 2, function (x) ifelse(is.na(x), 0, x)) %>% as.data.frame() %>% 
  kable(format = "html") %>% 
  kable_styling() %>% 
  add_header_above(c(" " = 1, "Cohort" = 2, "Hospital" = 2)) %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em") %>% 
  column_spec(4, width = "10em") %>% 
  column_spec(5, width = "10em")
```

**Education**

```{r}
giap %>% 
  select(Q30) %>% 
  mutate(Q30 = ifelse(is.na(Q30), 9, Q30),
         Degree = case_when(Q30 == 1 ~ "Diploma",
                            Q30 == 2 ~ "Associate Degree",
                            Q30 == 3 ~ "Baccalaureate Degree",
                            Q30 == 4 ~ "Master Degree",
                            Q30 == 5 ~ "Doctorate",
                            Q30 == 6 ~ "I am not a registered nurse",
                            Q30 == 9 ~ "Prefer not to Report")) %>% 
  group_by(Q30, Degree) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  select(-Q30) %>% 
  full_join(giap %>% 
  filter(Hospital.Name == name) %>% 
  select(Q30) %>% 
  mutate(Q30 = ifelse(is.na(Q30), 9, Q30),
         Degree = case_when(Q30 == 1 ~ "Diploma",
                            Q30 == 2 ~ "Associate Degree",
                            Q30 == 3 ~ "Baccalaureate Degree",
                            Q30 == 4 ~ "Master Degree",
                            Q30 == 5 ~ "Doctorate",
                            Q30 == 6 ~ "I am not a registered nurse",
                            Q30 == 9 ~ "Prefer not to Report")) %>% 
  group_by(Q30, Degree) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  select(-Q30), by = "Degree") %>% 
  mutate_if(is.numeric, na_to_zero) %>%
  setNames(c("Degree", "Cohort (%)", "Hospital (%)")) %>%    
  as.data.frame() %>% 
  kable(format = "html", table.attr = "style='width:90%;'") %>% 
  kable_styling() %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em")
```

**Shift Length**

```{r}
giap %>% 
  select(Q35) %>% 
  mutate(Q35 = ifelse(is.na(Q35), 9, Q35),
         Shift = case_when(Q35 == 1 ~ "8-hour shifts",
                            Q35 == 2 ~ "10-hour shifts",
                            Q35 == 3 ~ "12-hour shifts",
                            Q35 == 4 ~ "Flexible Schedule",
                            Q35 == 5 ~ "Other",
                            Q35 == 9 ~ "Did not Answer")) %>% 
  group_by(Shift, Q35) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  arrange(Q35) %>%
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  select(-Q35) %>% 
  full_join(giap %>% 
  filter(Hospital.Name == name) %>% 
  select(Q35) %>% 
  mutate(Q35 = ifelse(is.na(Q35), 9, Q35),
         Shift = case_when(Q35 == 1 ~ "8-hour shifts",
                            Q35 == 2 ~ "10-hour shifts",
                            Q35 == 3 ~ "12-hour shifts",
                            Q35 == 4 ~ "Flexible Schedule",
                            Q35 == 5 ~ "Other",
                            Q35 == 9 ~ "Did not Answer")) %>% 
  group_by(Shift, Q35) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  arrange(Q35) %>%
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  select(-Q35), by = "Shift") %>% 
  mutate_if(is.numeric, na_to_zero) %>%
  setNames(c("Shift Length", "Cohort (%)", "Hospital (%)")) %>%    
  as.data.frame() %>% 
  kable(format = "html", table.attr = "style='width:90%;'") %>% 
  kable_styling() %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em")
```

**Work Schedule**

```{r}
giap %>% 
  select(Q36) %>% 
  mutate(Q36 = ifelse(is.na(Q36), 9, Q36),
         Work = case_when(Q36 == 1 ~ "Day",
                            Q36 == 2 ~ "Evening",
                            Q36 == 3 ~ "Night",
                            Q36 == 4 ~ "Rotating Schedule",
                            Q36 == 9 ~ "Did not Answer")) %>% 
  group_by(Work, Q36) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  arrange(Q36) %>% 
  select(-Q36) %>% 
  full_join(giap %>% 
  filter(Hospital.Name == name) %>% 
  select(Q36) %>% 
  mutate(Q36 = ifelse(is.na(Q36), 9, Q36),
         Work = case_when(Q36 == 1 ~ "Day",
                            Q36 == 2 ~ "Evening",
                            Q36 == 3 ~ "Night",
                            Q36 == 4 ~ "Rotating Schedule",
                            Q36 == 9 ~ "Did not Answer")) %>% 
  group_by(Work, Q36) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  mutate(Count = round(Count / sum(Count) * 100, 1)) %>% 
  arrange(Q36) %>% 
  select(-Q36), by = "Work") %>% 
  mutate_if(is.numeric, na_to_zero) %>%
  setNames(c("Shift Length", "Cohort (%)", "Hospital (%)")) %>%    
  as.data.frame() %>% 
  kable(format = "html", table.attr = "style='width:90%;'") %>% 
  kable_styling() %>% 
  column_spec(1, width = "30em") %>%
  column_spec(2, width = "10em") %>% 
  column_spec(3, width = "10em") 
```


**This diagram depicts the extent to which the participating nurses are satisfied with their job.**

<center>
**Cohort**
</center>

```{r, fig.height=1, fig.width=9, fig.asp = .15, out.width = "95%"}
cols <- c("Strongly Disagree" = "#AE6180",
          "Disagree" = "#AE6180",
          "Neither agree nor disagree" = "#A3A9AC", 
          "Agree" = "#FFC842", 
          "Strongly Agree" = "#6BAB8A")

graph_data_score <- giap %>%
  filter(!is.na(Q32), Q32!=9) %>%
  rename(`Response` = Q32) %>%
  count(`Response`) %>%
  mutate(Percent = round(n / sum(n), 2),
         Item = "I am satisfied with my current job",
         Response_N = case_when(Response == 5 ~ "Disagree",
                           Response == 4 ~ "Disagree",
                           Response == 3 ~ "Neither agree nor disagree",
                           Response == 2 ~ "Agree",
                           Response == 1 ~ "Strongly Agree"),
         Response_N = ordered(Response_N, levels = rev(c("Disagree",
                                                     "Neither agree nor disagree",
                                                     "Agree",
                                                     "Strongly Agree"))),
         Score = case_when(Response == 5 ~ 1,
                           Response == 4 ~ 2,
                           Response == 3 ~ 3,
                           Response == 2 ~ 4,
                           Response == 1 ~ 5),
         Score = Score*n)

graph_data <- aggregate(n ~ Response_N, FUN = sum, graph_data_score) %>% 
  mutate(Item = "I am satisfied with my current job")
  
graph_data %>% 
  ggplot(aes(x = (Item), y = n, fill = Response_N)) +
  geom_bar(position = "fill", stat = "identity", width = .8, color = "white") +
  geom_point(aes(x = (Item), y = sum(Score)/(5*(sum(n)))), 
             shape = 8, 
             size = 1.5, 
             show.legend = FALSE, 
             stroke = 0.5, 
             data = graph_data_score) +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = cols) +
  labs(y = "", x = "", fill = "") +
  coord_flip() +
  theme_minimal() +
  theme(legend.position = "right", 
        axis.ticks.y = element_blank(), 
        panel.border = element_blank())
```

<center>
**`r name`**
</center>

```{r, fig.height=1, fig.width=9, fig.asp = .15, out.width = "95%"}
graph_data_score <- giap %>%
  filter(!is.na(Q32), Q32!=9, Hospital.Name==name) %>%
  rename(`Response` = Q32) %>%
  count(`Response`) %>%
  mutate(Percent = round(n / sum(n), 2),
         Item = "I am satisfied with my current job",
         Response_N = case_when(Response == 5 ~ "Disagree",
                           Response == 4 ~ "Disagree",
                           Response == 3 ~ "Neither agree nor disagree",
                           Response == 2 ~ "Agree",
                           Response == 1 ~ "Strongly Agree"),
         Response_N = ordered(Response_N, levels = rev(c("Disagree",
                                                     "Neither agree nor disagree",
                                                     "Agree",
                                                     "Strongly Agree"))),
         Score = case_when(Response == 5 ~ 1,
                           Response == 4 ~ 2,
                           Response == 3 ~ 3,
                           Response == 2 ~ 4,
                           Response == 1 ~ 5),
         Score = Score*n)

graph_data <- aggregate(n ~ Response_N, FUN = sum, graph_data_score) %>% 
  mutate(Item = "I am satisfied with my current job")
  
graph_data %>% 
  ggplot(aes(x = (Item), y = n, fill = Response_N)) +
  geom_bar(position = "fill", stat = "identity", width = .8, color = "white") +
  geom_point(aes(x = (Item), y = sum(Score)/(5*(sum(n)))), 
             shape = 8, 
             size = 1.5, 
             show.legend = FALSE, 
             stroke = 0.5, 
             data = graph_data_score) +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = cols) +
  labs(y = "", x = "", fill = "") +
  coord_flip() +
  theme_minimal() +
  theme(legend.position = "right", 
        axis.ticks.y = element_blank(), 
        panel.border = element_blank())
```

**This diagram depicts the extent to which the participating nurses find their work with older adults to be rewarding**

<center>
**Cohort**
</center>

```{r, fig.height=1, fig.width=9, fig.asp = .15, out.width = "95%"}
wrap_35 <- wrap_format(35)

cols <- c("Not rewarding" = "#AE6180",
          "Neutral" = "#A3A9AC", 
          "Somewhat rewarding" = "#FFC842", 
          "Very rewarding" = "#6BAB8A")

graph_data <- giap %>%
  filter(!is.na(Q12), Q12 != 9) %>%
  rename(`Response` = Q12) %>%
  count(`Response`) %>%
  mutate(Percent = round(n / sum(n), 2),
         Item = "How rewarding is your work with older adults",
         Response_N = case_when(Response == 4 ~ "Not rewarding",
                           Response == 3 ~ "Neutral",
                           Response == 2 ~ "Somewhat rewarding",
                           Response == 1 ~ "Very rewarding"),
         Response_N = ordered(Response_N, levels = rev(c("Not rewarding",
                                                     "Neutral",
                                                     "Somewhat rewarding",
                                                     "Very rewarding"))),
         Score = case_when(Response == 4 ~ 1,
                           Response == 3 ~ 2,
                           Response == 2 ~ 3,
                           Response == 1 ~ 4),
         Score = Score*n)

graph_data %>% 
  ggplot(aes(x = wrap_35(Item), y = n, fill = Response_N)) +
  geom_bar(position = "fill", stat = "identity", width = .8, color = "white") +
  geom_point(aes(x = wrap_35(Item), y = sum(Score)/(4*(sum(n)))), shape = 8, size = 1.5, show.legend = FALSE, stroke = 0.5 ) +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = cols) +
  labs(y = "", x = "", fill = "") +
  coord_flip() +
  theme_minimal() +
  theme(legend.position = "right", 
        axis.ticks.y = element_blank(), 
        panel.border = element_blank())
```

<center>
**`r name`**
</center>

```{r, fig.height=1, fig.width=9, fig.asp = .15, out.width = "95%"}
graph_data <- giap %>%
  filter(!is.na(Q12), Q12 != 9, Hospital.Name==name) %>%
  rename(`Response` = Q12) %>%
  count(`Response`) %>%
  mutate(Percent = round(n / sum(n), 2),
         Item = "How rewarding is your work with older adults",
         Response_N = case_when(Response == 4 ~ "Not rewarding",
                           Response == 3 ~ "Neutral",
                           Response == 2 ~ "Somewhat rewarding",
                           Response == 1 ~ "Very rewarding"),
         Response_N = ordered(Response_N, levels = rev(c("Not rewarding",
                                                     "Neutral",
                                                     "Somewhat rewarding",
                                                     "Very rewarding"))),
         Score = case_when(Response == 4 ~ 1,
                           Response == 3 ~ 2,
                           Response == 2 ~ 3,
                           Response == 1 ~ 4),
         Score = Score*n)

graph_data %>% 
  ggplot(aes(x = wrap_35(Item), y = n, fill = Response_N)) +
  geom_bar(position = "fill", stat = "identity", width = .8, color = "white") +
  geom_point(aes(x = wrap_35(Item), y = sum(Score)/(4*(sum(n)))), shape = 8, size = 1.5, show.legend = FALSE, stroke = 0.5 ) +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = cols) +
  labs(y = "", x = "", fill = "") +
  coord_flip() +
  theme_minimal() +
  theme(legend.position = "right", 
        axis.ticks.y = element_blank(), 
        panel.border = element_blank())
```

<center>
#### **GIAP Results**
</center>

**Baseline Knowledge of the Geriatric Syndromes**

The following diagram illustrates nurses' knowledge of evidence-based interventions to manage common problems experienced by older adults. The results for the Spring 2018 cohort and `r name` are presented below. The mean score for the correct answer for each clinical condition included in the GIAP is marked with an asterisks (*). A mean score of 80% or higher reflects nurses' mastery of the clinical knowledge needed to effectively assess, diagnose, and manage the geriatric syndromes and common nursing problems experienced by older adults during hospitalization.  

```{r}
knowledge <- giap %>%
  select(Hospital.ID, CASEID, Q42b, Q43c, Q44c, Q45b, Q46b, Q51b, Q47a, Q48d, Q49c, 
         Q50b, Q58c, Q59b, Q52a, Q56b, Q53b, Q55c, Q54c, Q57b, Q60c, Q61b) %>% 
  mutate_at(vars("Q42b", "Q43c", "Q44c", "Q45b", "Q46b", "Q51b", "Q47a", "Q48d", "Q49c",
                 "Q50b", "Q58c", "Q59b", "Q52a", "Q56b", "Q53b", "Q55c", "Q54c", "Q57b", 
                 "Q60c", "Q61b"), na_to_zero) %>%
  mutate(Falls = 0,
         Falls = ifelse(as.numeric(Q42b) == 1, Falls + 1, Falls + 0),
         Falls = ifelse(as.numeric(Q43c) == 1, Falls + 1, Falls + 0),
         Skin = 0,
         Skin = ifelse(as.numeric(Q44c) == 1, Skin + 1, Skin + 0),
         Skin = ifelse(as.numeric(Q45b) == 1, Skin + 1, Skin + 0),
         Assess = 0,
         Assess = ifelse(as.numeric(Q46b) == 1, Assess + 1, Assess + 0),
         Assess = ifelse(as.numeric(Q51b) == 1, Assess + 1, Assess + 0),
         Delirium = 0,
         Delirium = ifelse(as.numeric(Q47a) == 1, Delirium + 1, Delirium + 0),
         Urinary = 0,
         Urinary = ifelse(as.numeric(Q48d) == 1, Urinary + 1, Urinary + 0),
         Urinary = ifelse(as.numeric(Q49c) == 1, Urinary + 1, Urinary + 0),
         Nutrition = 0,
         Nutrition = ifelse(as.numeric(Q59b) == 1, Nutrition + 1, Nutrition + 0),
         Nutrition = ifelse(as.numeric(Q50b) == 1, Nutrition + 1, Nutrition + 0),
         Nutrition = ifelse(as.numeric(Q58c) == 1, Nutrition + 1, Nutrition + 0),
         Sleep = 0,
         Sleep = ifelse(as.numeric(Q52a) == 1, Sleep + 1, Sleep + 0),
         Sleep = ifelse(as.numeric(Q56b) == 1, Sleep + 1, Sleep + 0),
         Dementia = 0,
         Dementia = ifelse(as.numeric(Q53b) == 1, Dementia + 1, Dementia + 0),
         Dementia = ifelse(as.numeric(Q55c) == 1, Dementia + 1, Dementia + 0),
         Medication = 0,
         Medication = ifelse(as.numeric(Q54c) == 1, Medication + 1, Medication + 0),
         Medication = ifelse(as.numeric(Q57b) == 1, Medication + 1, Medication + 0),
         Depression = 0,
         Depression = ifelse(as.numeric(Q60c) == 1, Depression + 1, Depression + 0),
         Depression = ifelse(as.numeric(Q61b) == 1, Depression + 1, Depression + 0),
         Total = Falls + Skin + Assess + Delirium + Urinary + Nutrition + Sleep + 
           Dementia + Medication + Depression)

NICHE_colors <- c("#57068C","#6199AE","#FFC842","#314383","#6BAB8A","#F09C5D")
```

```{r}
NICHE_colors <- c("#57068C","#6199AE","#FFC842","#314383","#6BAB8A","#F09C5D")

falls <- count(knowledge, Falls) %>% 
  arrange(desc(Falls)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Falls = as.factor(Falls)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Falls)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0)+
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Falls") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)

skin <- count(knowledge, Skin) %>% 
  arrange(desc(Skin)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Skin = as.factor(Skin)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Skin)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0)+
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Skin") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)

assess <- count(knowledge, Assess) %>% 
  arrange(desc(Assess)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Assess = as.factor(Assess)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Assess)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0)+
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Assess") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)

delirium <- count(knowledge, Delirium) %>% 
  arrange(desc(Delirium)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Delirium = as.factor(Delirium)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Delirium)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0)+
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Delirium") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)

urinary <- count(knowledge, Urinary) %>% 
  arrange(desc(Urinary)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Urinary = as.factor(Urinary)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Urinary)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0)+
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Urinary") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)

nutrition <- count(knowledge, Nutrition) %>% 
  arrange(desc(Nutrition)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Nutrition = as.factor(Nutrition)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Nutrition)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0)+
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Nutrition") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)

sleep <- count(knowledge, Sleep) %>% 
  arrange(desc(Sleep)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Sleep = as.factor(Sleep)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Sleep)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0)+
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Sleep") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)

dementia <- count(knowledge, Dementia) %>% 
  arrange(desc(Dementia)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Dementia = as.factor(Dementia)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Dementia)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0)+
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Dementia") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)

medication <- count(knowledge, Medication) %>% 
  arrange(desc(Medication)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Medication = as.factor(Medication)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Medication)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0)+
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Medication") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)

depression <- count(knowledge, Depression) %>% 
  arrange(desc(Depression)) %>% 
  mutate(freq.prop = n / sum(n),
         lab.ypos = cumsum(freq.prop) - 0.5*freq.prop,
         Depression = as.factor(Depression)) %>% 
  ggplot(aes(x = 2, y = freq.prop, fill = Depression)) +
  geom_bar(stat = "identity", color = "white") +
  coord_polar(theta = "y", start = 0) +
  geom_text(aes(y = lab.ypos, label = round(freq.prop,1)), color = "white") +
  labs(title = "Depression") +
  scale_fill_manual(values = NICHE_colors, name = "Score") +
  theme_void ()+
  xlim(0.5, 2.5)
```


```{r, fig.asp=0.90, fig.width = 35, out.width='165%'}
ggpubr::ggarrange(falls, skin, assess, urinary, delirium, nutrition, sleep, dementia, medication, depression, ncol=2, nrow=5, common.legend = TRUE, legend = "bottom", widths = c(3,3), heights = c(3,3))
```


**This diagram depicts nurses' rating of organizational efforts to educate the workforce on the care of older adults.**

<center>
**Cohort Results**
</center>

```{r, fig.asp = .2, fig.width=14, out.width = "85%"}
wrap_15 <- wrap_format(15)
wrap_30 <- wrap_format(30)

cols <- c("Strongly Disagree" = "#474C4F",
          "Disagree" = "#AE6180", 
          "Neither Agree nor Disagree" = "#A3A9AC", 
          "Agree" = "#FFC842", 
          "Strongly Agree" = "#6BAB8A")

giap %>%
  select(Hospital.Name, CASEID, Q17) %>%
  gather(Item, Response, -Hospital.Name, -CASEID) %>% 
  filter(!is.na(Response), Response != 9) %>%
  mutate(Response = case_when(Response == 1 ~ "Strongly Disagree",
                              Response == 2 ~ "Disagree",
                              Response == 3 ~ "Neither Agree nor Disagree",
                              Response == 4 ~ "Agree",
                              Response == 5 ~ "Strongly Agree"),
         Response = ordered(Response, levels = rev(c("Strongly Disagree","Disagree","Neither Agree nor Disagree","Agree","Strongly Agree"))),
         Item = case_when(Item == "Q17" ~ "Job your institution has done educating staff about the care of the older adult")) %>% 
  count(Item, Response) %>%
  mutate(Item = wrap_30(Item)) %>% 
  ggplot(aes(x = Item, y = n, fill = Response)) +
  geom_bar(position = "fill", stat = "identity", width = .5, color = "white") +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = cols) +
  labs(y = "", x = "", fill = "") +
  coord_flip() +
  theme_minimal() +
  theme(legend.position = "right", 
        text = element_text(size = 20, color = "black"), 
        panel.border = element_blank())
```

<center>
**`r name` Results**
</center>

```{r, fig.asp = .2, fig.width=14, out.width = "85%"}
giap %>%
  filter(Hospital.Name == name) %>% 
  select(Hospital.Name, CASEID, Q17) %>%
  gather(Item, Response, -Hospital.Name, -CASEID) %>% 
  filter(!is.na(Response), Response != 9) %>%
  mutate(Response = case_when(Response == 1 ~ "Strongly Disagree",
                              Response == 2 ~ "Disagree",
                              Response == 3 ~ "Neither Agree nor Disagree",
                              Response == 4 ~ "Agree",
                              Response == 5 ~ "Strongly Agree"),
         Response = ordered(Response, levels = rev(c("Strongly Disagree","Disagree","Neither Agree nor Disagree","Agree","Strongly Agree"))),
         Item = case_when(Item == "Q17" ~ "Job your institution has done educating staff about the care of the older adult")) %>% 
  count(Item, Response) %>%
  mutate(Item = wrap_30(Item)) %>% 
  ggplot(aes(x = Item, y = n, fill = Response)) +
  geom_bar(position = "fill", stat = "identity", width = .5, color = "white") +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = cols) +
  labs(y = "", x = "", fill = "") +
  coord_flip() +
  theme_minimal() +
  theme(legend.position = "right", 
        text = element_text(size = 20, color = "black"), 
        panel.border = element_blank())
```

